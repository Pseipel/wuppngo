<mat-card class="container-fluid" *ngIf="activity">
	<h2 *ngIf="activity.name">{{ activity.name }}</h2>
	<h2 *ngIf="!activity.name">{{ constants.noTitle}}</h2>
	<form #activityForm="ngForm" (ngSubmit)="onSubmit()">
		<mat-card class="container-fluid">
			<mat-horizontal-stepper (selectionChange)="stepperValueChange($event)" linear="true" #stepper="matHorizontalStepper">
				<ng-template matStepperIcon="done">
					<fa-icon [icon]="faCheck"></fa-icon>
				</ng-template>
				<ng-template matStepperIcon="edit">
					<fa-icon [icon]="faCheck"></fa-icon>
				</ng-template>
				<mat-step [stepControl]="baseDataFormGroup">
					<form [formGroup]="baseDataFormGroup">
						<mat-card>
							<ng-template matStepLabel>{{constants.coreData}}</ng-template>
							<div class="container-fluid">
								<h2>{{constants.coreData}}</h2>
								<div class="row">
									<div class="col">
										<mat-form-field class="form-full-width">
											<input matInput type="text" formControlName="nameCtrl" placeholder={{constants.title}} name="name" value={{activity.name}}
											 required id="activity_name_field">
										</mat-form-field>
										<mat-form-field class="form-full-width">
											<textarea matInput type="text" formControlName="descriptionCtrl" placeholder="{{constants.description}}" name="description"
											 value={{activity.description}} id="activity_description_field" matTextareaAutosize matAutosizeMinRows="2" matAutosizeMaxRows="5"></textarea>
										</mat-form-field>
										<mat-form-field class="form-full-width">
											<mat-select required placeholder={{constants.organisation}} formControlName="providerCtrl" name="activity_provider_id">
												<mat-option *ngFor="let provider of providers" [value]="provider.id">{{provider.organisation ? provider.organisation.name : ''}}</mat-option>
											</mat-select>
										</mat-form-field>
										<mat-checkbox *ngIf="activity.provider && activity.provider.organisation" formControlName="showUserCtrl" name="showUser">{{constants.publicUser}}</mat-checkbox>
									</div>
									<div class="col">
										<mat-form-field class="tags-chip-list form-full-width">
											<mat-chip-list #chipList>
												<mat-chip *ngFor="let tag of activity.tags" selectable="true" removable="true">
													{{tag.name + ' '}}
													<fa-icon (click)="removeTag(tag)" [icon]="faTrashAlt" class="text-danger">
													</fa-icon>
												</mat-chip>
												<input placeholder={{constants.tags}} [matChipInputFor]="chipList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes" matChipInputAddOnBlur="true"
												 (matChipInputTokenEnd)="addTag($event)" />
											</mat-chip-list>
										</mat-form-field>
										<mat-form-field class="form-full-width">
											<mat-select required placeholder={{constants.category}} formControlName="categoryCtrl" name="activity_category">
												<mat-option *ngFor="let category of categories" [value]="category.id">{{category.name}}</mat-option>
											</mat-select>
										</mat-form-field>
										<mat-form-field class="form-full-width">
											<mat-select placeholder={{constants.targetGroups}} formControlName="targetGroupCtrl" name="activity_targetGroups" multiple>
												<mat-option *ngFor="let targetGroup of targetGroups" [value]="targetGroup.id">{{targetGroup.name}}</mat-option>
											</mat-select>
										</mat-form-field>
									</div>
								</div>
								<div>
									<button type="button" class="btn btn-primary" matStepperNext>{{constants.next}}</button>
								</div>
							</div>
						</mat-card>
					</form>
				</mat-step>
				<mat-step>
					<ng-template matStepLabel>{{constants.translations}}</ng-template>
					<translatable-form #translatableFieldsComponent [multiLingualObject]="activity" [translatableAttributes]="['name', 'description']"></translatable-form>
					<div>
						<button type="button" class="btn btn-secondary" matStepperPrevious>{{constants.previous}}</button>
						<button type="button" class="btn btn-primary" matStepperNext>{{constants.next}}</button>
					</div>
				</mat-step>
				<mat-step [stepControl]="addressFormGroup">
					<ng-template matStepLabel>{{constants.address}}</ng-template>
					<div class="container-fluid">
						<h2>{{constants.placeQuestion}}</h2>
						<form [formGroup]="addressFormGroup">
							<mat-card class="address-card" *ngIf="activity.address">
								<div *ngIf="addressFormGroup.invalid">
									<address-autocomplete-form #addressAutocompleteComponent [initialAddress]="activity.address"></address-autocomplete-form>
									<button type="button" class="btn btn-primary" (click)="addressSubmit()">{{constants.ok}}</button>
								</div>
								<div *ngIf="!addressFormGroup.invalid">
									{{addressFormGroup.controls.addressCtrl.value.toString}}
									<button type="button" class="btn btn-primary" (click)="resetAddress()">{{constants.change}}</button>
								</div>
							</mat-card>
							<div>
								<button type="button" class="btn btn-secondary" matStepperPrevious>{{constants.previous}}</button>
								<button type="button" class="btn btn-primary" [disabled]="addressFormGroup.invalid" matStepperNext>{{constants.next}}</button>
							</div>
						</form>
					</div>
				</mat-step>

				<mat-step [stepControl]="schedulesFormGroup">
					<ng-template matStepLabel>{{constants.dates}}</ng-template>
					<scheduler-component-form #schedulerComponent [schedules]="activity.schedules" (onScheduleChange)="onScheduleChange($event)"></scheduler-component-form>
					<button type="button" class="btn btn-secondary" matStepperPrevious>{{constants.previous}}</button>
					<button type="button" class="btn btn-primary" color="primary" [disabled]="schedulesFormGroup.invalid" (click)="saveTranslations()"
					 matStepperNext>{{constants.next}}</button>
				</mat-step>

				<mat-step>
					<ng-template matStepLabel>{{constants.summary}}</ng-template>
					<div>{{constants.pleaseControl}}</div>
					<activity-detail *ngIf="activity && user" [activity]="activity"></activity-detail>
					<div>
						<button type="button" class="btn btn-secondary" matStepperPrevious>{{constants.previous}}</button>
						<button type="submit" class="btn btn-primary">{{constants.save}}</button>
					</div>
				</mat-step>
			</mat-horizontal-stepper>
			<button type="button" class="btn btn-danger" (click)="back()">{{constants.cancel}}</button>
		</mat-card>
	</form>
</mat-card>
